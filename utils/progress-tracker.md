# 开发进度跟踪系统

> **版本**: v2.1.0
> **创建日期**: 2026-01-07
> **用途**: Smart Flow 工作流进度跟踪
> **显示**: 整数百分比（0-100%），无小数

---

## 📊 进度阶段

### Smart Flow 工作流包含 4 个主要阶段：

```yaml
Phase 1: 需求澄清 (Requirements Clarity)
  - 权重: 20%
  - 任务: 使用 AskUserQuestion 收集需求，达到质量阈值
  - 产出: 结构化需求文档

Phase 2: 任务分解 (Task Decomposition)
  - 权重: 30%
  - 任务: 分解任务，推荐 Agent，创建实施计划
  - 产出: 任务列表 + Agent 分配

Phase 3: 并行执行 (Parallel Execution)
  - 权重: 40%
  - 任务: 并行启动多个 Agent，执行具体任务
  - 产出: 各 Agent 输出结果

Phase 4: 结果综合 (Result Synthesis)
  - 权重: 10%
  - 任务: 汇总结果，质量检查，生成最终报告
  - 产出: 综合实施报告
```

---

## 🎯 进度计算

### 计算公式

```python
总进度 = (Phase1进度 × 20% + Phase2进度 × 30% + Phase3进度 × 40% + Phase4进度 × 10%)

# 示例：
Phase1: 100% × 20% = 20%
Phase2: 60% × 30% = 18%
Phase3: 0% × 40% = 0%
Phase4: 0% × 10% = 0%
总进度: 38%
```

### 进度整数化

```python
最终进度 = round(总进度)  # 四舍五入到整数
```

---

## 📝 详细计算示例

### 示例 1: 初始阶段

**场景**: 刚完成需求澄清的第1步

**步骤1**: 确定各阶段进度
```yaml
Phase 1 (需求澄清):
  步骤 1.1 完成: ✅ 是
  步骤 1.2 完成: ❌ 否
  当前进度: 10% (只有1.1完成)

Phase 2 (任务分解): 0%
Phase 3 (并行执行): 0%
Phase 4 (结果综合): 0%
```

**步骤2**: 计算加权进度
```python
Phase1加权进度 = 10% × 20% = 2%
Phase2加权进度 = 0% × 30% = 0%
Phase3加权进度 = 0% × 40% = 0%
Phase4加权进度 = 0% × 10% = 0%

总进度 = 2% + 0% + 0% + 0% = 2%
最终进度 = round(2%) = 2%
```

**步骤3**: 显示进度
```
总进度: 2%
```

---

### 示例 2: 中期阶段

**场景**: 需求澄清100%完成，任务分解50%完成，并行执行刚开始

**步骤1**: 确定各阶段进度
```yaml
Phase 1 (需求澄清): 100% (所有步骤完成)
Phase 2 (任务分解): 50% (完成2.1, 2.2, 2.3，进行中2.4)
Phase 3 (并行执行): 10% (刚启动Agent)
Phase 4 (结果综合): 0%
```

**步骤2**: 计算加权进度
```python
Phase1加权进度 = 100% × 20% = 20%
Phase2加权进度 = 50% × 30% = 15%
Phase3加权进度 = 10% × 40% = 4%
Phase4加权进度 = 0% × 10% = 0%

总进度 = 20% + 15% + 4% + 0% = 39%
最终进度 = round(39%) = 39%
```

**步骤3**: 显示进度
```
总进度: 39%
```

---

### 示例 3: 后期阶段

**场景**: 前3个阶段都完成，结果综合进行中

**步骤1**: 确定各阶段进度
```yaml
Phase 1 (需求澄清): 100%
Phase 2 (任务分解): 100%
Phase 3 (并行执行): 100%
Phase 4 (结果综合): 60% (汇总完成，质量检查中)
```

**步骤2**: 计算加权进度
```python
Phase1加权进度 = 100% × 20% = 20%
Phase2加权进度 = 100% × 30% = 30%
Phase3加权进度 = 100% × 40% = 40%
Phase4加权进度 = 60% × 10% = 6%

总进度 = 20% + 30% + 40% + 6% = 96%
最终进度 = round(96%) = 96%
```

**步骤3**: 显示进度
```
总进度: 96%
```

---

### 示例 4: 完整工作流追踪

**场景**: 完整执行一个博客系统开发任务

| 时间点 | Phase1进度 | Phase2进度 | Phase3进度 | Phase4进度 | 总进度计算 | 总进度 |
|--------|-----------|-----------|-----------|-----------|-----------|--------|
| 开始 | 0% | 0% | 0% | 0% | 0×20%+0×30%+0×40%+0×10% | 0% |
| 需求澄清中 | 30% | 0% | 0% | 0% | 30%×20%+0×30%+0×40%+0×10% | 6% |
| 需求澄清完成 | 100% | 0% | 0% | 0% | 100%×20%+0×30%+0×40%+0×10% | 20% |
| 任务分解中 | 100% | 40% | 0% | 0% | 100%×20%+40%×30%+0×40%+0×10% | 32% |
| 任务分解完成 | 100% | 100% | 0% | 0% | 100%×20%+100%×30%+0×40%+0×10% | 50% |
| 并行执行开始 | 100% | 100% | 10% | 0% | 100%×20%+100%×30%+10%×40%+0×10% | 54% |
| 并行执行过半 | 100% | 100% | 50% | 0% | 100%×20%+100%×30%+50%×40%+0×10% | 70% |
| 并行执行完成 | 100% | 100% | 100% | 0% | 100%×20%+100%×30%+100%×40%+0×10% | 90% |
| 结果综合中 | 100% | 100% | 100% | 50% | 100%×20%+100%×30%+100%×40%+50%×10% | 95% |
| **全部完成** | 100% | 100% | 100% | 100% | 100%×20%+100%×30%+100%×40%+100%×10% | **100%** |

---

### 关键计算原则

1. **阶段进度是独立的**: 每个阶段的进度单独计算，不依赖其他阶段
2. **加权求和**: 总进度是各阶段加权进度的简单求和
3. **整数化**: 最终显示时四舍五入到整数
4. **实时更新**: 每个步骤完成后立即更新该阶段进度
5. **准确性**: 基于实际完成情况，不估算未来进度

---

## 📈 进度显示格式

### 文本格式

```markdown
## Smart Flow 工作流进度

Phase 1: 需求澄清     ████████████░░░░░░░░░░ 100%
Phase 2: 任务分解     ████████░░░░░░░░░░░░░░  60%
Phase 3: 并行执行     ░░░░░░░░░░░░░░░░░░░░░░   0%
Phase 4: 结果综合     ░░░░░░░░░░░░░░░░░░░░░░   0%
────────────────────────────────────────────
总进度: ████████░░░░░░░░░░░░░░  38%
```

### JSON 格式

```json
{
  "workflow_progress": {
    "phase1_requirements": {
      "name": "需求澄清",
      "progress": 100,
      "weight": 20,
      "weighted_progress": 20
    },
    "phase2_decomposition": {
      "name": "任务分解",
      "progress": 60,
      "weight": 30,
      "weighted_progress": 18
    },
    "phase3_execution": {
      "name": "并行执行",
      "progress": 0,
      "weight": 40,
      "weighted_progress": 0
    },
    "phase4_synthesis": {
      "name": "结果综合",
      "progress": 0,
      "weight": 10,
      "weighted_progress": 0
    },
    "total_progress": 38
  }
}
```

---

## 🔄 各阶段详细进度

### Phase 1: 需求澄清 (20%)

```yaml
步骤 1.1: 初始化质量评分 (10%)
  完成: [是/否]

步骤 1.2: 第1批提问 (30%)
  完成: [是/否]
  问题数: [X/3]

步骤 1.3: 第2批提问 (60%)
  完成: [是/否]
  问题数: [X/3]

步骤 1.4: 第3批提问 (90%)
  完成: [是/否]
  问题数: [X/3]

步骤 1.5: 生成需求文档 (100%)
  完成: [是/否]
  质量评分: [X/100]

当前进度: [已完成步骤百分比]%
```

### Phase 2: 任务分解 (30%)

```yaml
步骤 2.1: 分析需求类型 (10%)
  完成: [是/否]
  类型: [简单/中等/复杂]

步骤 2.2: 推荐 Agent (30%)
  完成: [是/否]
  推荐数量: [X]

步骤 2.3: 任务分解 (60%)
  完成: [是/否]
  任务数量: [X]

步骤 2.4: 创建实施计划 (90%)
  完成: [是/否]
  计划文档: [路径]

步骤 2.5: 用户确认 (100%)
  完成: [是/否]

当前进度: [已完成步骤百分比]%
```

### Phase 3: 并行执行 (40%)

```yaml
步骤 3.1: 启动 Agent (10%)
  完成: [是/否]
  已启动: [X/总Agent数]

步骤 3.2: Agent 执行中 (50%)
  完成: [是/否]
  完成数量: [X/总Agent数]

步骤 3.3: Agent 完成 (90%)
  完成: [是/否]
  成功: [X], 失败: [Y], 运行中: [Z]

步骤 3.4: 结果收集 (100%)
  完成: [是/否]
  收集率: [X]%

当前进度: [已完成步骤百分比]%
```

### Phase 4: 结果综合 (10%)

```yaml
步骤 4.1: 汇总结果 (30%)
  完成: [是/否]

步骤 4.2: 质量检查 (60%)
  完成: [是/否]
  通过率: [X]%

步骤 4.3: 生成最终报告 (100%)
  完成: [是/否]
  报告路径: [路径]

当前进度: [已完成步骤百分比]%
```

---

## 📊 实时进度更新示例

### 示例 1: 开始工作流

```markdown
## Smart Flow 工作流进度

Phase 1: 需求澄清     ████░░░░░░░░░░░░░░░░░░  20%
Phase 2: 任务分解     ░░░░░░░░░░░░░░░░░░░░░░   0%
Phase 3: 并行执行     ░░░░░░░░░░░░░░░░░░░░░░   0%
Phase 4: 结果综合     ░░░░░░░░░░░░░░░░░░░░░░   0%
────────────────────────────────────────────
总进度: ██░░░░░░░░░░░░░░░░░░░░   4%

✅ 已完成: 初始化质量评分
🔄 进行中: 第1批提问 (问题 1/3)
```

### 示例 2: 需求澄清完成

```markdown
## Smart Flow 工作流进度

Phase 1: 需求澄清     ████████████░░░░░░░░░░ 100% ✅
Phase 2: 任务分解     ██████░░░░░░░░░░░░░░░░  50% 🔄
Phase 3: 并行执行     ░░░░░░░░░░░░░░░░░░░░░░   0%
Phase 4: 结果综合     ░░░░░░░░░░░░░░░░░░░░░░   0%
────────────────────────────────────────────
总进度: ████████████░░░░░░░░░░  35%

✅ Phase 1 完成: 需求文档已生成
🔄 Phase 2 进行中: 推荐合适 Agent...
```

### 示例 3: 并行执行中

```markdown
## Smart Flow 工作流进度

Phase 1: 需求澄清     ████████████░░░░░░░░░░ 100% ✅
Phase 2: 任务分解     ████████████░░░░░░░░░░ 100% ✅
Phase 3: 并行执行     ████████░░░░░░░░░░░░░░  60% 🔄
Phase 4: 结果综合     ░░░░░░░░░░░░░░░░░░░░░░   0%
────────────────────────────────────────────
总进度: ███████████████░░░░░░░░  69%

🔄 Agent 执行中:
  ✅ product-manager (100%)
  ✅ ui-ux-designer (100%)
  ✅ backend-architect (100%)
  🔄 frontend-developer (60%)
  ⏳ database-architect (等待中)
```

### 示例 4: 工作流完成

```markdown
## Smart Flow 工作流进度

Phase 1: 需求澄清     ████████████░░░░░░░░░░ 100% ✅
Phase 2: 任务分解     ████████████░░░░░░░░░░ 100% ✅
Phase 3: 并行执行     ████████████░░░░░░░░░░ 100% ✅
Phase 4: 结果综合     ████████████░░░░░░░░░░ 100% ✅
────────────────────────────────────────────
总进度: ████████████░░░░░░░░░░ 100% ✅

🎉 工作流完成！
📄 最终报告: smart-flow-reports/report-2026-01-07.md
```

---

## ⚙️ 进度更新规则

### 何时更新进度

```yaml
1. 完成每个步骤后: 立即更新
2. Agent 状态变化: 实时更新
3. 用户交互后: 立即更新
4. 错误发生: 更新并标记
```

### 进度显示位置

```yaml
1. 主窗口顶部: 始终显示总进度
2. 每个阶段开始: 显示该阶段详细进度
3. Agent 执行中: 显示 Agent 完成情况
4. 工作流结束: 显示完整进度报告
```

---

## 🎨 可视化选项

### 进度条样式

```markdown
方式1: ████░░░░░░░░░░░░░░░░░░ (标准)
方式2: ▓▓▓▓▓▓▓▓░░░░░░░░░░░░░ (方块)
方式3: ████████░░░░░░░░░░░░░ (粗线条)
方式4: [████████░░] (带边框)
```

### 状态图标

```yaml
✅ 完成 (已完成)
🔄 进行中 (正在执行)
⏳ 等待中 (队列中)
❌ 失败 (执行失败)
⚠️ 警告 (有问题)
🎉 成功 (全部完成)
```

---

## ⚠️ 注意事项

1. **整数显示**: 所有百分比四舍五入到整数
2. **实时更新**: 每个步骤完成后立即更新
3. **准确性**: 基于实际完成情况，不估算
4. **透明性**: 显示每个阶段的详细进度
5. **一致性**: 整个工作流使用相同的显示格式

---

## 📊 版本历史

- **v2.1.0** (2026-01-07): 初始版本，4阶段进度跟踪，整数百分比

---

**维护者**: Smart Flow Team
**最后更新**: 2026-01-07
