# 需求质量评分系统

> **版本**: v2.1.0
> **创建日期**: 2026-01-07
> **用途**: Smart Flow 需求澄清质量评分

---

## 📊 评分维度（100分制）

### 1. 商业价值与目标（30分）

#### 1.1 问题陈述清晰（10分）
- **10分**: 问题清晰具体，有明确的痛点描述
- **7分**: 问题基本清晰，但细节不足
- **4分**: 问题模糊，表述笼统
- **0分**: 未描述问题或完全无法理解

**评分标准**:
```
✅ 清晰: "用户每次导出Excel报表需要等待5分钟，影响工作效率"
⚠️ 一般: "用户反馈系统太慢"
❌ 模糊: "系统需要优化"
```

#### 1.2 目标用户明确（10分）
- **10分**: 目标用户群体清晰，有用户画像
- **7分**: 知道目标用户是谁，但缺乏细节
- **4分**: 目标用户模糊
- **0分**: 未提及目标用户

**评分标准**:
```
✅ 清晰: "目标用户：财务部门的数据分析师，每天处理10+报表"
⚠️ 一般: "财务人员"
❌ 模糊: "内部用户"
```

#### 1.3 成功标准可衡量（10分）
- **10分**: 有明确的量化指标和验收标准
- **7分**: 有定性描述，但不可量化
- **4分**: 成功标准模糊
- **0分**: 未定义成功标准

**评分标准**:
```
✅ 清晰: "导出时间从5分钟降至10秒以内，支持100万行数据"
⚠️ 一般: "导出速度明显提升"
❌ 模糊: "改善用户体验"
```

---

### 2. 功能需求（25分）

#### 2.1 核心功能明确（10分）
- **10分**: 核心功能列表清晰，优先级明确
- **7分**: 有功能列表，但优先级不清
- **4分**: 功能描述笼统
- **0分**: 未列出核心功能

**评分标准**:
```
✅ 清晰: "核心功能（P0）: 1. 异步导出 2. 进度显示 3. 邮件通知"
⚠️ 一般: "需要导出功能和进度提示"
❌ 模糊: "做一个导出功能"
```

#### 2.2 用户流程清晰（10分）
- **10分**: 完整的用户流程图，包含主要路径和异常处理
- **7分**: 有基本流程，但异常处理不足
- **4分**: 流程片段化
- **0分**: 无流程描述

**评分标准**:
```
✅ 清晰:
用户 → 选择导出范围 → 配置导出选项 → 开始导出 → 显示进度 → 完成通知
异常处理: 导出失败 → 重试/联系管理员
⚠️ 一般: "用户点击导出，等待完成"
❌ 模糊: "用户操作"
```

#### 2.3 边界条件考虑（5分）
- **5分**: 明确的功能边界和排除项
- **3分**: 有边界考虑，但不完整
- **1分**: 边界模糊
- **0分**: 未考虑边界

**评分标准**:
```
✅ 清晰:
包含: 导出CSV、Excel、PDF格式
不包含: 实时数据推送、自定义报表设计
⚠️ 一般: "支持常见格式"
❌ 模糊: 未说明
```

---

### 3. 用户体验（20分）

#### 3.1 交互流程合理（10分）
- **10分**: 交互流程清晰，符合用户习惯
- **7分**: 基本流程合理，细节待定
- **4分**: 交互设计粗糙
- **0分**: 未考虑交互

**评分标准**:
```
✅ 清晰:
- 导出按钮在数据列表右上角
- 配置弹窗支持保存预设
- 进度条实时更新，显示预计剩余时间
⚠️ 一般: "有导出按钮和进度提示"
❌ 模糊: 未说明
```

#### 3.2 界面风格明确（5分）
- **5分**: 明确的设计风格或UI框架
- **3分**: 有基本风格要求
- **1分**: 风格模糊
- **0分**: 未提及风格

**评分标准**:
```
✅ 清晰: "使用 Ant Design Vue 组件库，遵循现有系统设计规范"
⚠️ 一般: "简洁现代风格"
❌ 模糊: 未说明
```

#### 3.3 易用性考虑（5分）
- **5分**: 考虑了易用性（快捷键、默认值、帮助文档）
- **3分**: 有基本易用性考虑
- **1分**: 易用性考虑不足
- **0分**: 未考虑易用性

**评分标准**:
```
✅ 清晰:
- 记住上次导出配置
- 提供常用配置预设
- 操作引导和帮助文档
⚠️ 一般: "界面友好"
❌ 模糊: 未说明
```

---

### 4. 技术约束（15分）

#### 4.1 技术栈明确（8分）
- **8分**: 前后端技术栈、数据库、框架全部明确
- **5分**: 核心技术栈明确
- **2分**: 技术栈模糊
- **0分**: 未提及技术栈

**评分标准**:
```
✅ 清晰:
前端: Vue 3 + Ant Design Vue
后端: Django REST Framework
数据库: PostgreSQL 14
缓存: Redis
⚠️ 一般: "Python + Vue"
❌ 模糊: 未说明
```

#### 4.2 性能要求（4分）
- **4分**: 明确的性能指标（响应时间、并发量、数据量）
- **2分**: 有基本性能要求
- **1分**: 性能要求模糊
- **0分**: 未提及性能

**评分标准**:
```
✅ 清晰: "100万行数据导出在10秒内完成，支持100并发用户"
⚠️ 一般: "性能要好"
❌ 模糊: 未说明
```

#### 4.3 安全考虑（3分）
- **3分**: 明确的安全要求（权限、加密、审计）
- **2分**: 有基本安全考虑
- **1分**: 安全考虑不足
- **0分**: 未考虑安全

**评分标准**:
```
✅ 清晰:
- 导出权限校验（仅本人可导出自己的数据）
- 敏感数据脱敏
- 导出日志记录
⚠️ 一般: "注意安全"
❌ 模糊: 未说明
```

---

### 5. 范围与优先级（10分）

#### 5.1 MVP范围明确（5分）
- **5分**: 清晰定义MVP范围，区分必须和可选功能
- **3分**: 有基本范围定义
- **1分**: 范围模糊
- **0分**: 未定义范围

**评分标准**:
```
✅ 清晰:
MVP (P0):
- 异步导出CSV
- 进度显示
- 邮件通知

后续迭代 (P1):
- 支持Excel、PDF
- 导出模板管理
- 定时任务
⚠️ 一般: "先做基本的导出"
❌ 模糊: 未说明
```

#### 5.2 优先级排序（5分）
- **5分**: 所有功能都有明确的优先级（P0/P1/P2）
- **3分**: 核心功能有优先级
- **1分**: 优先级混乱
- **0分**: 未定义优先级

**评分标准**:
```
✅ 清晰:
- P0: 异步导出、进度显示 (必须)
- P1: 邮件通知、模板管理 (重要)
- P2: 定时任务、数据预览 (可选)
⚠️ 一般: "核心功能优先"
❌ 模糊: 未排序
```

---

## 🎯 评分阈值

### 质量等级

| 分数范围 | 等级 | 含义 | 后续行动 |
|---------|------|------|---------|
| **90-100** | 优秀 | 需求清晰，可以直接实施 | ✅ 生成PRD，进入开发 |
| **75-89** | 良好 | 需求基本清晰，有少量缺口 | ⚠️ 补充1-2轮提问 |
| **60-74** | 中等 | 需求模糊，有较多缺口 | ⚠️ 补充2-3轮提问 |
| **<60** | 较差 | 需求非常模糊 | ❌ 需要深入澄清 |

### 阈值设置

**默认阈值**: 90分

**规则**:
- 如果当前评分 < 90分：继续提问
- 如果当前评分 ≥ 90分：生成PRD文档

---

## 🔄 评分流程

### 初始化评分

```python
def initialize_score():
    return {
        "business_value": {
            "problem_clarity": 0,  # 0-10
            "target_users": 0,     # 0-10
            "success_criteria": 0  # 0-10
        },
        "functional_requirements": {
            "core_features": 0,    # 0-10
            "user_flow": 0,        # 0-10
            "boundary_conditions": 0  # 0-5
        },
        "user_experience": {
            "interaction_flow": 0, # 0-10
            "ui_style": 0,         # 0-5
            "usability": 0         # 0-5
        },
        "technical_constraints": {
            "tech_stack": 0,       # 0-8
            "performance": 0,      # 0-4
            "security": 0          # 0-3
        },
        "scope_priority": {
            "mvp_scope": 0,        # 0-5
            "prioritization": 0    # 0-5
        }
    }

def calculate_total_score(scores):
    total = 0
    for category in scores.values():
        for item_score in category.values():
            total += item_score
    return total  # Max 100
```

### 动态更新评分

```python
def update_score(current_scores, new_information):
    """根据新信息更新评分"""

    # 示例：用户提供了问题描述
    if "problem_description" in new_information:
        clarity = assess_problem_clarity(new_information["problem_description"])
        current_scores["business_value"]["problem_clarity"] = clarity

    # 示例：用户提供了技术栈
    if "tech_stack" in new_information:
        completeness = assess_tech_stack(new_information["tech_stack"])
        current_scores["technical_constraints"]["tech_stack"] = completeness

    return calculate_total_score(current_scores)
```

### 提问策略

```python
def next_question_category(current_scores):
    """确定下一个问题类别"""

    # 找出得分最低的类别
    category_scores = {
        "problem": current_scores["business_value"]["problem_clarity"],
        "users": current_scores["business_value"]["target_users"],
        "success": current_scores["business_value"]["success_criteria"],
        # ...
    }

    # 返回得分最低的类别
    return min(category_scores, key=category_scores.get)
```

---

## 📝 评分示例

### 示例 1: 初始状态（用户只说"我要做一个导出功能"）

```yaml
初始评分:
  商业价值与目标: 0/30
    - 问题陈述清晰: 0/10 (未描述问题)
    - 目标用户明确: 0/10 (未提及用户)
    - 成功标准可衡量: 0/10 (未定义标准)

  功能需求: 5/25
    - 核心功能明确: 5/10 (提到了导出，但不明确)
    - 用户流程清晰: 0/10 (无流程)
    - 边界条件考虑: 0/5 (未考虑边界)

  用户体验: 0/20
    - 交互流程合理: 0/10 (未考虑交互)
    - 界面风格明确: 0/5 (未提及风格)
    - 易用性考虑: 0/5 (未考虑易用性)

  技术约束: 0/15
    - 技术栈明确: 0/8 (未提及技术栈)
    - 性能要求: 0/4 (未提及性能)
    - 安全考虑: 0/3 (未考虑安全)

  范围与优先级: 0/10
    - MVP范围明确: 0/5 (未定义范围)
    - 优先级排序: 0/5 (未定义优先级)

总分: 5/100
结论: 需求非常模糊，需要深入澄清
下一步: 提问 - 问题陈述、目标用户
```

### 示例 2: 第一轮提问后

```yaml
用户回答:
  问题: "财务人员导出数据太慢，需要5分钟，影响工作"
  用户: "财务部门的数据分析师"
  目标: "导出速度提升到10秒内"

更新评分:
  商业价值与目标: 25/30 (+25)
    - 问题陈述清晰: 8/10 (+8) - 清楚但有改进空间
    - 目标用户明确: 9/10 (+9) - 明确
    - 成功标准可衡量: 8/10 (+8) - 可衡量

  功能需求: 5/25 (不变)

  用户体验: 0/20 (不变)

  技术约束: 0/15 (不变)

  范围与优先级: 0/10 (不变)

总分: 30/100 (+25)
结论: 仍有较大缺口
下一步: 提问 - 核心功能、技术栈、用户流程
```

### 示例 3: 第二轮提问后

```yaml
用户回答:
  功能: "异步导出、进度显示、邮件通知"
  技术栈: "Django + Vue + PostgreSQL + Redis"
  流程: "用户选择数据 → 配置导出 → 后台处理 → 进度更新 → 完成通知"

更新评分:
  商业价值与目标: 25/30

  功能需求: 22/25 (+17)
    - 核心功能明确: 9/10 (+9) - 清晰
    - 用户流程清晰: 8/10 (+8) - 合理
    - 边界条件考虑: 5/5 (+5) - 后续迭代

  用户体验: 15/20 (+15)
    - 交互流程合理: 8/10 (+8) - 合理
    - 界面风格明确: 3/5 (+3) - 提到Vue
    - 易用性考虑: 4/5 (+4) - 有考虑

  技术约束: 13/15 (+13)
    - 技术栈明确: 8/8 (+8) - 完整
    - 性能要求: 4/4 (+4) - 明确
    - 安全考虑: 1/3 (+1) - 基本考虑

  范围与优先级: 5/10 (+5)
    - MVP范围明确: 5/5 (+5) - MVP清晰
    - 优先级排序: 0/5 (未定义)

总分: 80/100 (+50)
结论: 需求基本清晰，接近阈值
下一步: 提问 - 优先级排序、安全细节
```

### 示例 4: 第三轮提问后（达到阈值）

```yaml
用户回答:
  优先级: "P0: 异步导出、进度；P1: 邮件、模板；P2: 定时任务"
  安全: "权限校验、数据脱敏、日志记录"

更新评分:
  商业价值与目标: 25/30

  功能需求: 22/25

  用户体验: 15/20

  技术约束: 15/15 (+2)
    - 安全考虑: 3/3 (+2) - 完整

  范围与优先级: 10/10 (+5)
    - 优先级排序: 5/5 (+5) - 明确

总分: 87/100... 等等，让我重新评估：
- 商业价值: 25/30
- 功能需求: 22/25
- 用户体验: 15/20
- 技术约束: 15/15
- 范围与优先级: 10/10
总分: 87/100

结论: 接近90分，基本可以进入开发
或: 补充1个细节问题，确保达到90分
```

---

## 🚀 使用指南

### 在 Agent 中使用

```markdown
## Step 1: 初始化评分
当前需求质量评分: **5/100** ❌

### Step 2: 第一轮提问
[使用 AskUserQuestion 工具提问]

### Step 3: 更新评分
当前需求质量评分: **30/100** ⚠️

### Step 4: 第二轮提问
[使用 AskUserQuestion 工具提问]

### Step 5: 更新评分
当前需求质量评分: **80/100** ⚠️

### Step 6: 第三轮提问
[使用 AskUserQuestion 工具提问]

### Step 7: 达到阈值
当前需求质量评分: **92/100** ✅

✅ 需求澄清完成！生成PRD文档...
```

---

## ⚠️ 注意事项

1. **评分要客观**: 基于用户实际提供的信息，不要主观猜测
2. **渐进式提问**: 每次提问针对得分最低的维度
3. **及时更新**: 每轮提问后立即更新评分
4. **达到阈值即可**: 不要过度追求100分，90分即可进入开发
5. **灵活性**: 根据具体项目调整评分权重

---

## 📊 版本历史

- **v2.1.0** (2026-01-07): 初始版本，定义5大维度、100分制、90分阈值

---

**维护者**: Smart Flow Team
**最后更新**: 2026-01-07
