---
name: requirements-clarity
description: "Use when user wants to build something but requirements are unclear, vague, or incomplete. Forces systematic questioning before any implementation."
---

# Requirements Clarity - 需求澄清

## ⚠️ 强制执行要求

**你必须使用 `AskUserQuestion` 工具来收集用户需求！**

**你必须使用质量评分系统来评估需求清晰度！**

当这个技能被触发时，你**必须**执行以下步骤：

### 步骤 1: 初始化质量评分

**立即评估当前需求质量评分（0-100分）**：

```yaml
商业价值与目标（30分）:
  - 问题陈述清晰: 10分
  - 目标用户明确: 10分
  - 成功标准可衡量: 10分

功能需求（25分）:
  - 核心功能明确: 10分
  - 用户流程清晰: 10分
  - 边界条件考虑: 5分

用户体验（20分）:
  - 交互流程合理: 10分
  - 界面风格明确: 5分
  - 易用性考虑: 5分

技术约束（15分）:
  - 技术栈明确: 8分
  - 性能要求: 4分
  - 安全考虑: 3分

范围与优先级（10分）:
  - MVP范围明确: 5分
  - 优先级排序: 5分

总分: [X]/100
```

**评分等级**:
- **90-100分**: ✅ 优秀，可以直接实施
- **75-89分**: ⚠️ 良好，补充1-2轮提问
- **60-74分**: ⚠️ 中等，补充2-3轮提问
- **<60分**: ❌ 较差，需要深入澄清

### 步骤 2: 分批提问

**立即调用 `AskUserQuestion` 工具**:
- 设计 **2-3个关键问题**（不要一次问太多）
- 每个问题提供 **2-4个选项**
- 支持多选时设置 `multiSelect: true`
- **优先针对得分最低的维度**提问

### 步骤 3: 更新评分并继续

**等待用户回答后**:
1. **更新质量评分**（根据用户的回答）
2. **检查是否达到阈值（90分）**
3. **如果 < 90分**：继续下一轮提问（2-3个问题）
4. **如果 ≥ 90分**：生成 PRD 文档

**重要**:
- 不要假设用户想要什么
- 不要自己编造需求
- 每轮只问2-3个问题，避免信息过载
- 迭代直到评分 ≥ 90分

### 步骤 4: 生成结构化需求文档

基于用户的回答，输出 JSON 格式的需求文档。

---

## 概述

**核心原则**: 拒绝猜测，强制询问 + 质量评分驱动

在开始任何开发工作之前，必须：
1. 彻底理解用户的需求（通过系统性提问）
2. 确保需求质量达到90分以上
3. 避免需求返工和开发浪费

## 触发条件

**自动触发**以下情况：
- 用户说"帮我做一个功能"但没有具体说明
- 需求描述少于 50 字
- 包含模糊词汇："大概"、"可能"、"应该"、"像..."
- 提到"新增"、"开发"、"实现"但缺乏细节

## 提问流程

### 第一轮：核心目标
```
1. 功能目标是什么？
   - 这个功能要解决什么问题？
   - 期望达到什么效果？

2. 目标用户是谁？
   - 谁会使用这个功能？
   - 用户的技能水平如何？
```

### 第二轮：功能范围
```
3. 核心功能有哪些？
   - 哪些是必须功能？（MVP）
   - 哪些是可选功能？（加分项）
   - 哪些功能明确不需要？

4. 有具体的参考或竞品吗？
   - 有类似的实现可以参考吗？
   - 有竞品可以模仿吗？
```

### 第三轮：技术约束
```
5. 技术栈偏好？
   - 前端：Vue/React/原生？
   - 后端：Python/Node.js/Go/Java？
   - 数据库：MySQL/PostgreSQL/MongoDB？
   - 有特定框架要求吗？

6. 约束条件？
   - 时间：有截止日期吗？
   - 性能：有性能要求吗？
   - 安全：需要特殊安全措施吗？
   - 兼容性：需要支持哪些浏览器/设备？
```

### 第四轮：验证确认
```
7. 成功标准是什么？
   - 如何判断这个功能成功了？
   - 有具体的验收标准吗？

8. 潜在风险？
   - 有什么可能出错的地方？
   - 有什么技术难点需要提前考虑？
```

## 提问技巧

### ✅ 好的提问方式
- **一次一个问题**: 不要一次问太多
- **选择题优先**: "A. Vue B. React C. 无所谓" 比 "用什么框架?" 更好
- **具体化**: "用户登录需要支持第三方登录吗(如微信/GitHub)?" 比 "还有其他要求吗?" 更好
- **举例说明**: "比如像淘宝的商品列表那样？" 帮助用户理解

### ❌ 避免的提问方式
- **多个问题**: 一次问 3+ 个问题，用户会困惑
- **开放过泛**: "你想要什么?" 太宽泛
- **术语过多**: "需要 RESTful API 还是 GraphQL?" 用户可能不懂
- **假设**: "你肯定需要数据库吧?" 不要假设

## 输出格式

完成澄清后，生成结构化需求文档：

```json
{
  "requirement_id": "REQ-2025-01-07-001",
  "timestamp": "2025-01-07T14:30:22Z",
  "project_name": "用户登录功能",
  "core_objective": "提供用户注册、登录、登出功能",
  "target_users": "网站注册用户",
  "must_have_features": [
    "用户注册(邮箱/手机号)",
    "用户登录(邮箱/手机号+密码)",
    "密码加密存储",
    "登出功能"
  ],
  "optional_features": [
    "第三方登录(微信/GitHub)",
    "记住登录状态",
    "找回密码"
  ],
  "tech_stack": {
    "frontend": "Vue 3",
    "backend": "Python/Django",
    "database": "MySQL 8.0"
  },
  "constraints": {
    "security": "密码必须加密",
    "performance": "登录响应时间 < 1秒",
    "compatibility": "支持 Chrome/Firefox/Safari"
  },
  "success_criteria": [
    "用户可以成功注册",
    "用户可以成功登录",
    "密码安全存储",
    "登出后清除会话"
  ],
  "references": [
    "GitHub 登录流程",
    "淘宝用户注册"
  ]
}
```

## 特殊情况处理

### 用户也不确定怎么办？
1. **提供选项**: "您更倾向于 A. 简单快速 B. 功能完整 C. 先做 MVP"
2. **分阶段**: "建议先做 MVP 版本，包含核心功能，后续再扩展"
3. **参考案例**: "有类似的功能可以参考吗？比如淘宝的登录？"

### 用户说"你看着办"？
不要接受！必须澄清：
```
"我理解您希望我来做决定。但为了避免浪费您的时间，
我需要确认几个关键点，否则可能做出来的东西不是您想要的..."
```

### 需求变更怎么办？
1. 记录变更点
2. 评估影响
3. 确认是否重新开始分解任务

## 检查清单

完成需求澄清前，确保：
- [ ] 功能目标清晰
- [ ] 目标用户明确
- [ ] 必须功能 vs 可选功能区分清楚
- [ ] 技术栈确定（或明确"无所谓"）
- [ ] 约束条件明确
- [ ] 有参考案例（或明确"没有")
- [ ] 成功标准可衡量

## 示例对话

### ❌ 不好的例子
```
你: 帮我做一个登录功能

AI: 好的，我马上帮你做...
[直接开始写代码，结果做出来不是用户想要的]
```

### ✅ 好的例子（质量评分驱动）

```
你: 帮我做一个登录功能

AI: 我来帮你设计登录功能。在开始之前，让我先评估当前需求质量。

## 初始评分

商业价值与目标: 0/30
  - 问题陈述清晰: 0/10
  - 目标用户明确: 0/10
  - 成功标准可衡量: 0/10

功能需求: 5/25
  - 核心功能明确: 5/10 (提到了登录，但不明确)
  - 用户流程清晰: 0/10
  - 边界条件考虑: 0/5

用户体验: 0/20
技术约束: 0/15
范围与优先级: 0/10

**当前评分: 5/100** ❌ 需求非常模糊，需要深入澄清

---

## 第一轮提问（核心目标）

[使用 AskUserQuestion 工具]

Q1: 这个登录功能的目标是什么？
   A. 网站用户登录
   B. 管理后台登录
   C. 两者都需要

Q2: 目标用户是谁？
   A. 普通网站访客
   B. 内部管理员
   C. 两者都有

Q3: 主要痛点是什么？
   A. 现有登录太慢
   B. 没有登录功能
   C. 需要支持多种登录方式

你: A, A, B

AI: 明白了。让我更新评分。

## 第一轮后评分

商业价值与目标: 22/30 (+22)
  - 问题陈述清晰: 8/10 (+8) - 清楚：需要新建登录功能
  - 目标用户明确: 9/10 (+9) - 明确：普通网站访客
  - 成功标准可衡量: 5/10 (+5) - 基本明确，还需细化

功能需求: 5/25 (不变)
用户体验: 0/20
技术约束: 0/15
范围与优先级: 0/10

**当前评分: 27/100** ⚠️ 仍有较大缺口

---

## 第二轮提问（功能范围）

Q4: 核心功能包括哪些？（多选）
   [ ] 用户注册（邮箱/手机号）
   [ ] 用户登录（邮箱+密码）
   [ ] 第三方登录（微信/GitHub）
   [ ] 找回密码
   [ ] 记住登录状态

Q5: 技术栈偏好？
   A. Django + Vue3
   B. FastAPI + React
   C. 无特别要求

你: [选择所有功能], C

AI: 好的。让我更新评分。

## 第二轮后评分

商业价值与目标: 22/30

功能需求: 20/25 (+15)
  - 核心功能明确: 9/10 (+9) - 功能清晰
  - 用户流程清晰: 8/10 (+8) - 基本流程清楚
  - 边界条件考虑: 3/5 (+3) - 有基本考虑

用户体验: 10/20 (+10)
  - 交互流程合理: 8/10 (+8) - 流程合理
  - 界面风格明确: 2/5 (+2) - 未明确

技术约束: 8/15 (+8)
  - 技术栈明确: 8/8 (+8) - 明确无要求
  - 性能要求: 0/4
  - 安全考虑: 0/4

范围与优先级: 5/10 (+5)
  - MVP范围明确: 5/5 (+5) - MVP清晰
  - 优先级排序: 0/5

**当前评分: 65/100** ⚠️ 中等，继续补充

---

## 第三轮提问（细节完善）

Q6: 性能要求是什么？
   A. 登录响应 < 1秒
   B. 登录响应 < 2秒
   C. 无特别要求

Q7: 安全要求？（多选）
   [ ] 密码加密存储
   [ ] 防止暴力破解（验证码/限流）
   [ ] 登录日志记录
   [ ] Token过期时间

Q8: 成功标准是什么？
   A. 用户可以成功注册登录
   B. 用户可以成功注册登录 + 性能达标
   C. 用户可以成功注册登录 + 性能达标 + 安全通过审计

你: A, [选择所有安全项], B

AI: 完美！让我更新评分。

## 第三轮后评分

商业价值与目标: 27/30 (+5)
  - 成功标准可衡量: 10/10 (+5) - 完全明确

功能需求: 20/25

用户体验: 15/20 (+5)
  - 界面风格明确: 5/5 (+3) - 明确无要求

技术约束: 15/15 (+7)
  - 性能要求: 4/4 (+4) - 明确
  - 安全考虑: 3/3 (+3) - 完整

范围与优先级: 10/10 (+5)
  - 优先级排序: 5/5 (+5) - MVP优先

**当前评分: 92/100** ✅ 优秀，可以直接实施！

---

## 需求澄清完成

✅ 需求质量评分已达到阈值（92/100），现在开始生成 PRD 文档...

[生成结构化需求文档]
```

---

## 关键要点

1. **每次提问前显示当前评分**：让用户看到进度
2. **优先提问得分最低的维度**：高效提升评分
3. **每轮只问2-3个问题**：避免信息过载
4. **实时更新评分**：让用户看到进展
5. **达到90分立即停止**：避免过度提问

## 后续步骤

需求澄清完成后：
1. 生成结构化需求文档（JSON 格式）
2. 进入下一阶段：任务分解 (`smart-flow:task-decomposer`)

---

**技能依赖**: 无
**后续技能**: `smart-flow:task-decomposer`
**版本**: v1.0.0
