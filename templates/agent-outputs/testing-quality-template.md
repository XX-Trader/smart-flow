# Smart Flow v2.1.0 - 测试与质量类 Agent 输出模板

**适用 Agent**: test-automator, code-reviewer, security-auditor, api-security-audit, test-driven-development, verification-before-completion, debugger, error-detective

**模板版本**: v2.1.0
**最后更新**: 2025-01-07

---

## 📋 通用输出结构

所有测试与质量类 Agent 应遵循以下输出结构:

```markdown
# [Agent Name] - 执行报告

## 1. 任务概要
## 2. 分析过程
## 3. 发现/结果
## 4. 行动建议
## 5. 风险评估
```

---

## 🧪 1. Test Automator（测试自动化工程师）

### 核心职责
设计并实现自动化测试体系，包括单元测试、集成测试、E2E测试和性能测试

### 输出模板

```markdown
# Test Automator - 测试自动化报告

**任务ID**: [TASK-ID]
**执行时间**: [YYYY-MM-DD HH:MM:SS]
**测试范围**: [Scope Description]
**测试框架**: [Framework Name + Version]

---

## 1. 测试策略与范围

### 1.1 测试类型
- [ ] 单元测试
- [ ] 集成测试
- [ ] 端到端测试 (E2E)
- [ ] 性能测试
- [ ] 安全测试

### 1.2 覆盖范围
- **核心功能**: [列出测试的功能模块]
- **边界条件**: [列出测试的边界场景]
- **异常路径**: [列出测试的异常流程]

### 1.3 测试框架选择
- **框架**: [Jest / Pytest / Cypress / Playwright]
- **断言库**: [Assertion Library]
- **Mock 工具**: [Mocking Library]
- **覆盖率工具**: [Coverage Tool]

---

## 2. 测试计划

### 2.1 测试用例清单

| 用例ID | 测试场景 | 测试类型 | 优先级 | 状态 |
|--------|---------|---------|--------|------|
| TC-001 | [场景描述] | [类型] | P0-P3 | ✅/❌ |

#### 详细测试用例示例

**TC-001: [用例名称]**
- **测试目标**: [验证什么功能/行为]
- **前置条件**: [执行前需要满足的条件]
- **测试步骤**: 1.[步骤1] 2.[步骤2] 3.[步骤3]
- **预期结果**: [应该发生什么]
- **实际结果**: [实际发生了什么]
- **状态**: PASS / FAIL

### 2.2 测试数据设计

```javascript
// 测试数据结构示例
const testData = {
  validCases: [
    { input: "...", expected: "..." }
  ],
  invalidCases: [
    { input: "...", expectedError: "..." }
  ],
  edgeCases: [
    { input: "...", expected: "..." }
  ]
};
```

---

## 3. 自动化测试代码示例

### 3.1 单元测试

```javascript
describe('[功能模块]', () => {
  it('should [预期行为]', () => {
    const input = '...';
    const result = functionToTest(input);
    expect(result).toBe('...');
  });
});
```

### 3.2 集成测试 & E2E测试

```javascript
// 集成测试示例
describe('[模块集成]', () => {
  it('should complete [流程]', async () => {
    await page.goto('/path');
    await page.fill('#input', 'value');
    await expect(page).toHaveURL(/success/);
  });
});
```

### 3.3 Mock配置

```javascript
jest.mock('[模块名]', () => ({
  [函数名]: jest.fn(() => [返回值])
}));
```

---

## 4. 测试执行结果

### 4.1 执行摘要
- **总用例数**: X | **通过**: X | **失败**: X | **跳过**: X | **通过率**: XX%

### 4.2 覆盖率报告

```
File                |  % Stmts | % Branch |  % Funcs |  % Lines |
--------------------|----------|----------|----------|----------|
[文件名]            |    XX.XX |    XX.XX |    XX.XX |    XX.XX |
All files           |    XX.XX |    XX.XX |    XX.XX |    XX.XX |
```

### 4.3 失败用例详情

| 用例ID | 失败原因 | 错误信息 | 严重程度 |
|--------|---------|---------|---------|
| TC-XXX | [原因] | `[Error]` | High/Med/Low |

---

## 5. 性能测试结果

### 5.1 性能指标

| 指标 | 目标值 | 实际值 | 状态 |
|------|--------|--------|------|
| 响应时间 | < 200ms | XXXms | ✅/❌ |
| 吞吐量 | > 1000 req/s | XXX req/s | ✅/❌ |

---

## 6. 缺陷报告

### 6.1 发现的缺陷

| 缺陷ID | 严重程度 | 缺陷描述 | 复现步骤 |
|--------|---------|---------|---------|
| BUG-001 | Critical | [描述] | [步骤] |

---

## 7. 行动建议

### 7.1 立即修复（P0）
- [ ] [BUG-001] [描述]

### 7.2 优先修复（P1）
- [ ] [优化项]

### 7.3 后续优化（P2）
- [ ] [改进项]

---

## 8. 总结

### 8.1 质量评估
- **代码质量**: ⭐⭐⭐⭐☆ (X/5)
- **测试完整性**: ⭐⭐⭐☆☆ (X/5)
- **可维护性**: ⭐⭐⭐⭐☆ (X/5)

### 8.2 发布建议
- **建议**: [可以发布 / 需要修复关键问题]
- **风险**: [低 / 中 / 高]
- **阻塞问题**: [列出]

### 8.3 下一步行动
1. [行动项1]
2. [行动项2]
```

---

## 🔍 2. Code Reviewer（代码审查专家）

### 核心职责
全面审查代码质量，包括功能正确性、代码质量、可维护性、性能、安全性等

### 输出模板

```markdown
# Code Reviewer - 代码审查报告

**PR ID**: #[PR Number]
**审查范围**: [Files / Lines]
**审查时间**: [YYYY-MM-DD HH:MM:SS]

---

## 1. 审查概要

### 1.1 变更摘要
- **文件数**: X | **新增行数**: +XXX | **删除行数**: -XXX
- **修改文件**: [列出关键文件]

### 1.2 审查结论
- **总体评价**: [LGTM / 需要修改 / 需要重大修改]
- **风险等级**: [低 / 中 / 高]
- **建议**: [可以合并 / 修改后合并]

---

## 2. 审查维度

### 2.1 功能正确性
- [x] 代码实现了预期功能
- [x] 边界条件处理正确
- [x] 错误处理完善

### 2.2 代码质量
- [x] 命名清晰，符合规范
- [x] 逻辑简洁，易于理解
- [x] 避免代码重复

### 2.3 可维护性
- [x] 代码结构清晰
- [x] 注释恰当且必要
- [x] 易于扩展

### 2.4 性能与效率
- [x] 算法效率合理
- [x] 无明显性能问题

### 2.5 安全性
- [x] 无安全漏洞
- [x] 输入验证完善

### 2.6 测试覆盖
- [x] 测试覆盖充分
- [x] 边界条件已测试

### 2.7 文档完整性
- [x] API 文档完整
- [x] 变更说明清晰

---

## 3. 详细审查意见

### 3.1 必须修复（Blocker）

#### ❌ [文件名:行号] - [问题描述]
```diff
- // 原代码
+ // 建议修改
```
**严重程度**: Critical / High
**原因**: [为什么这是问题]
**建议**: [如何修复]

### 3.2 建议修改（Major）

#### ⚠️ [文件名:行号] - [问题描述]
**严重程度**: Medium
**原因**: [为什么建议修改]

### 3.3 优化建议（Minor）

#### 💡 [文件名:行号] - [优化建议]
**优化类型**: [代码风格 / 命名 / 简化]

### 3.4 值得表扬（Positive）

#### ✅ [文件名:行号] - [做得好的地方]

---

## 4. 性能与安全审查

### 4.1 性能问题
| 位置 | 问题 | 影响 | 建议 |
|------|------|------|------|
| [file:line] | [描述] | [影响] | [优化] |

### 4.2 安全问题
| 位置 | 问题 | 风险等级 | 建议 |
|------|------|---------|------|
| [file:line] | [描述] | High/Med/Low | [修复] |

---

## 5. 审查总结

### 5.1 优点
1. [优点1]
2. [优点2]

### 5.2 需要改进
1. [改进项1]
2. [改进项2]

### 5.3 最终建议
- **合并建议**: [LGTM / 修改后合并]
- **预计修改时间**: [X小时 / X天]
- **风险等级**: [低 / 中 / 高]

### 5.4 后续行动
- [作者] 修复必须修复的问题
- [审查者] 再次审查
```

---

## 🔒 3. Security Auditor（安全审计专家）

### 核心职责
全面审计系统安全性，识别漏洞并提供修复方案

### 输出模板

```markdown
# Security Auditor - 安全审计报告

**审计范围**: [System / Module / API]
**审计时间**: [YYYY-MM-DD HH:MM:SS]
**审计标准**: [OWASP Top 10 / CWE]

---

## 1. 审计概要

### 1.1 风险摘要

| 严重程度 | 数量 | 百分比 |
|---------|------|--------|
| Critical | X | XX% |
| High | X | XX% |
| Medium | X | XX% |
| Low | X | XX% |

### 1.2 审计结论
- **总体安全等级**: ⭐⭐⭐☆☆ (X/5)
- **建议**: [可以上线 / 需要修复关键问题]

---

## 2. 关键安全发现（Critical）

### 🔴 Critical-001: [漏洞名称]
- **位置**: [文件名:行号]
- **CWE ID**: [CWE-XXX]
- **OWASP**: [A01-A10]

#### 描述
[详细描述漏洞]

#### 漏洞代码示例
```javascript
// 漏洞代码
const userInput = req.params.id;
const query = `SELECT * FROM users WHERE id = ${userInput}`;
```

#### 修复建议
```javascript
// 修复后
const query = 'SELECT * FROM users WHERE id = ?';
db.query(query, [userInput]);
```

#### 优先级: **立即修复**

---

## 3. 高危安全发现（High）

### 🟠 High-001: [问题名称]
- **位置**: [文件名:行号]
- **描述**: [详细描述]
- **优先级**: **本周修复**

---

## 4. 安全漏洞分类

### 4.1 注入漏洞

| 漏洞 | 位置 | 严重程度 | 状态 |
|------|------|---------|------|
| SQL注入 | [file:line] | Critical | ❌ |

### 4.2 认证与授权

| 问题 | 位置 | 严重程度 | 状态 |
|------|------|---------|------|
| 权限绕过 | [file:line] | Critical | ❌ |

### 4.3 数据泄露

| 问题 | 位置 | 严重程度 | 状态 |
|------|------|---------|------|
| 敏感数据硬编码 | [file:line] | Critical | ❌ |

---

## 5. 依赖安全审查

### 5.1 已知漏洞依赖

| 包名 | 版本 | CVE ID | 严重程度 | 修复版本 |
|------|------|--------|---------|---------|
| [package] | [version] | CVE-XXXX-XXXX | Critical | [version] |

### 5.2 过期依赖

| 包名 | 当前版本 | 最新版本 |
|------|---------|---------|
| [package] | x.x.x | x.x.x |

---

## 6. 修复优先级与路线图

### 6.1 立即修复（P0 - 1周内）
1. [Critical-001] [简述]
2. [High-001] [简述]

### 6.2 优先修复（P1 - 1月内）
1. [High-002] [简述]

### 6.3 计划修复（P2 - 3月内）
1. [Medium-001] [简述]

---

## 7. 总结

### 7.1 安全成熟度评估
- **当前成熟度**: Level [1-5]
- **目标成熟度**: Level [X]

### 7.2 关键建议
1. [建议1]
2. [建议2]

### 7.3 下一步行动
- [ ] [行动项1]
- [ ] [行动项2]
```

---

## 🔌 4. API Security Auditor（API安全审计专家）

### 核心职责
专项审计API安全，基于OWASP API Security Top 10标准

### 输出模板（简化版）

```markdown
# API Security Auditor - API安全审计报告

**API范围**: [API Name / Version]
**审计标准**: [OWASP API Security Top 10]

---

## 1. 审计概要

### 1.1 API基本信息
- **API名称**: [名称]
- **认证方式**: [JWT / OAuth2 / API Key]
- **端点数量**: X

### 1.2 风险分布

| OWASP API Top 10 | 发现数量 | 严重程度 |
|------------------|---------|---------|
| API1: Broken Object Level Authorization | X | Critical |
| API3: Excessive Data Exposure | X | Medium |

---

## 2. OWASP API Security Top 10 检查

### API1: Broken Object Level Authorization
**状态**: ❌ / ✅

#### 问题示例
```
GET /api/users/123 → 修改为 GET /api/users/456
Result: ❌ Can access other user's data
```

#### 修复建议
```javascript
if (req.user.id !== parseInt(req.params.id)) {
  return res.status(403).json({ error: 'Forbidden' });
}
```

### API2: Broken User Authentication
**状态**: ❌ / ✅

**检查项**:
- [ ] 弱密码策略
- [ ] 会话超时过长
- [ ] Token 可预测
- [ ] 缺少速率限制

### API3: Excessive Data Exposure
**状态**: ❌ / ✅

#### 问题示例
```json
// ❌ 不应返回
{
  "passwordHash": "xxx",
  "ssn": "xxx"
}
```

### API4: Lack of Resources & Rate Limiting
**状态**: ❌ / ✅

### API5: Broken Function Level Authorization
**状态**: ❌ / ✅

### API6: Mass Assignment
**状态**: ❌ / ✅

### API7: Security Misconfiguration
**状态**: ❌ / ✅

**检查项**:
- [ ] CORS 配置过于宽松
- [ ] 错误信息泄露
- [ ] 调试模式开启

### API8: Injection
**状态**: ❌ / ✅

**测试项**:
- SQL注入
- NoSQL注入
- 命令注入

### API9: Improper Assets Management
**状态**: ❌ / ✅

### API10: Insufficient Logging & Monitoring
**状态**: ❌ / ✅

---

## 3. 端点级安全审查（示例）

### POST /api/auth/login
- **认证**: ❌ 不需要
- **输入验证**: ✅ / ❌
- **速率限制**: ✅ / ❌
- **安全问题**: [列表]

---

## 4. 修复优先级

### 4.1 立即修复（P0）
1. [API1] 对象级别授权问题
2. [API3] 敏感数据泄露
3. [API8] SQL注入

### 4.2 优先修复（P1）
1. [API2] 认证机制改进
2. [API4] 速率限制

---

## 5. 总结

### 5.1 安全评分
- **总体评分**: ⭐⭐☆☆☆ (2/5)
- **认证**: ⭐⭐⭐☆☆ (3/5)
- **授权**: ⭐⭐☆☆☆ (2/5)
- **数据保护**: ⭐☆☆☆☆ (1/5)

### 5.2 关键建议
1. [建议1]
2. [建议2]

### 5.3 下一步行动
- [ ] [行动项1]
```

---

## 📝 5. Test Driven Development（测试驱动开发专家）

### 核心职责
执行TDD开发流程：Red → Green → Refactor

### 输出模板

```markdown
# TDD Expert - 测试驱动开发执行报告

**任务**: [Feature / Bug Fix]
**TDD周期**: Red → Green → Refactor

---

## 1. TDD执行流程

### 1.1 Red Phase（编写失败测试）
**目标**: 先写测试，确定需求

**测试用例**:
```javascript
describe('[功能描述]', () => {
  it('should [预期行为]', () => {
    // 测试代码
  });
});
```

**测试结果**: ❌ FAILED (as expected)

---

### 1.2 Green Phase（最简实现）
**目标**: 让测试通过的最简代码

**实现代码**:
```javascript
function implementation() {
  // 最简实现
}
```

**测试结果**: ✅ PASSED

---

### 1.3 Refactor Phase（重构优化）
**目标**: 优化代码，保持测试通过

**重构后代码**:
```javascript
function implementation() {
  // 优化后的实现
}
```

**测试结果**: ✅ PASSED

---

## 2. 测试用例清单

### 2.1 单元测试

| 用例 | 场景 | 状态 |
|------|------|------|
| TC-001 | [正常场景] | ✅ |
| TC-002 | [边界条件] | ✅ |

### 2.2 集成测试

| 用例 | 场景 | 状态 |
|------|------|------|
| IC-001 | [集成场景] | ✅ |

---

## 3. 代码覆盖率

```
File        |  % Stmts | % Branch |  % Funcs |  % Lines |
------------|----------|----------|----------|----------|
[文件名]    |    100   |    100   |    100   |    100   |
```

---

## 4. TDD最佳实践

- [x] 先写测试，后写代码
- [x] 小步快跑，频繁迭代
- [x] 测试驱动设计
- [x] 保持测试简洁

---

## 5. 总结

### 5.1 TDD周期统计
- **Red-Green-Refactor循环**: X 次
- **总用时**: X 分钟
- **测试用例**: X 个
- **代码覆盖率**: XX%

### 5.2 经验总结
1. [经验1]
2. [经验2]
```

---

## ✅ 6. Verification Before Completion（完成前验证）

### 核心职责
任务完成前的全面验证检查

### 输出模板

```markdown
# Verification Before Completion - 完成前验证报告

**任务**: [Task Description]
**验证结果**: ✅ PASS / ❌ FAIL

---

## 1. 验证清单

### 1.1 功能完整性
- [x] 所有功能已实现
- [x] 符合需求规格
- [x] 边界条件处理

### 1.2 代码质量
- [x] 代码风格一致
- [x] 命名清晰
- [x] 适当注释

### 1.3 测试覆盖
- [x] 单元测试完整
- [x] 集成测试通过
- [x] 边界测试覆盖

### 1.4 文档完整性
- [x] README 更新
- [x] API 文档完整
- [x] CHANGELOG 更新

### 1.5 性能与安全
- [x] 无明显性能问题
- [x] 无安全漏洞

---

## 2. 阻塞问题

### 2.1 必须修复
- [ ] [问题1]
- [ ] [问题2]

### 2.2 建议修复
- [ ] [问题1]

---

## 3. 验证结论

### 3.1 总体评估
- **完成度**: XX%
- **质量等级**: ⭐⭐⭐⭐☆
- **建议**: [可以完成 / 需要修复后完成]

### 3.2 下一步行动
1. [行动1]
2. [行动2]
```

---

## 🐛 7. Debugger（调试专家）

### 核心职责
诊断和修复Bug，提供根本原因分析和修复方案

### 输出模板

```markdown
# Debugger - 调试分析报告

**问题**: [Bug Description]
**调试状态**: 🔍 Root Cause Found / ✅ Fixed

---

## 1. 问题概述

### 1.1 问题描述
- **症状**: [具体表现]
- **影响**: [影响范围]
- **频率**: [偶发 / 必现]
- **环境**: [OS / Browser / Version]

### 1.2 复现步骤
1. [步骤1]
2. [步骤2]
3. [步骤3]

**预期行为**: [应该怎样]
**实际行为**: [实际怎样]

---

## 2. 调试过程

### 2.1 初步分析
- **问题类型**: [逻辑 / 性能 / 兼容 / 资源]
- **可能原因**: [初步假设]

### 2.2 日志分析
```log
[相关日志]
```

**发现**: [从日志中发现什么]

### 2.3 代码追踪
**文件**: [file:line]
```javascript
// 问题代码
```

---

## 3. 根本原因

### 3.1 Root Cause
[根本原因描述]

### 3.2 触发条件
- [条件1]
- [条件2]

---

## 4. 修复方案

### 4.1 推荐方案
```javascript
// 修复代码
```

**优点**: [为什么这样修复]
**缺点**: [可能的副作用]

### 4.2 备选方案
```javascript
// 备选代码
```

---

## 5. 验证

### 5.1 修复验证
- [x] 本地验证通过
- [x] 单元测试通过

### 5.2 回归测试
- [x] 无副作用
- [x] 性能无影响

---

## 6. 预防措施

### 6.1 代码改进
- [建议1]
- [建议2]

### 6.2 测试增强
- [需要增加的测试]

---

## 7. 总结

### 7.1 问题总结
- **问题**: [简述]
- **根因**: [简述]
- **修复**: [简述]
- **验证**: [状态]

### 7.2 经验教训
1. [教训1]
2. [教训2]

### 7.3 知识沉淀
- [新增到知识库的内容]
```

---

## 🔎 8. Error Detective（错误侦探）

### 核心职责
分析日志错误，识别错误模式和根本原因

### 输出模板

```markdown
# Error Detective - 错误模式分析报告

**分析范围**: [Project / Module]
**错误总数**: X

---

## 1. 错误概览

### 1.1 错误分布

| 严重程度 | 数量 | 百分比 |
|---------|------|--------|
| Critical | X | XX% |
| Error | X | XX% |
| Warning | X | XX% |

### 1.2 错误趋势
[错误趋势图或描述]

---

## 2. 错误模式识别

### 2.1 高频错误

#### Error-001: [错误名称]
- **类型**: [TypeError / ReferenceError / NetworkError]
- **频率**: X times/hour
- **文件**: [file:line]
- **错误信息**: `[Error Message]`
- **根因**: [分析]
- **修复建议**: [建议]

---

### 2.2 错误聚类

#### 模式1: [模式名称]
- **相关错误**: Error-001, Error-002, Error-003
- **共同特征**: [描述]
- **根因分析**: [分析]
- **统一修复**: [方案]

---

## 3. 错误根因分析

### 3.1 根因分类

| 类别 | 数量 | 占比 |
|------|------|------|
| 逻辑错误 | X | XX% |
| 配置错误 | X | XX% |
| 依赖问题 | X | XX% |

### 3.2 Top 5 Root Causes
1. [根因1] - X次
2. [根因2] - X次
3. [根因3] - X次
4. [根因4] - X次
5. [根因5] - X次

---

## 4. 错误影响分析

### 4.1 用户影响
- **受影响用户**: X
- **影响操作**: [操作列表]
- **影响时长**: X minutes

### 4.2 业务影响
- **交易失败**: X
- **数据丢失**: X
- **SLA 违反**: Yes / No

---

## 5. 修复优先级

### 5.1 立即修复（P0）
- [ ] [Error-001] [原因]

### 5.2 优先修复（P1）
- [ ] [Error-002] [原因]

### 5.3 计划修复（P2）
- [ ] [Error-003] [原因]

---

## 6. 监控改进建议

### 6.1 告警配置
- [新增告警]
  - 条件: [Condition]
  - 阈值: [Threshold]

### 6.2 日志增强
- [需要增加的日志]
  - 位置: [Location]

---

## 7. 预防措施

### 7.1 代码层面
- [改进1]
- [改进2]

### 7.2 流程层面
- [改进1]

### 7.3 架构层面
- [改进1]

---

## 8. 总结

### 8.1 关键发现
1. [发现1]
2. [发现2]

### 8.2 修复建议
1. [建议1]
2. [建议2]

### 8.3 下一步行动
- [ ] [行动1]
- [ ] [行动2]
```

---

## 📊 模板使用指南

### 选择合适的模板

1. **test-automator**: 需要编写自动化测试时
2. **code-reviewer**: 代码审查 PR 时
3. **security-auditor**: 全面安全审计时
4. **api-security-audit**: API 专项安全审计时
5. **test-driven-development**: TDD 开发流程
6. **verification-before-completion**: 任务完成前验证
7. **debugger**: Bug 调试分析
8. **error-detective**: 日志错误分析

### 模板定制原则

- 删除不适用的章节
- 增加项目特定的检查项
- 调整评分标准
- 修改输出格式

### 最佳实践

1. **完整输出**: 确保所有相关章节都有内容
2. **具体明确**: 避免模糊描述，提供具体示例
3. **可操作性**: 建议应该具体、可执行
4. **优先级清晰**: 明确标记必须修复 vs 建议改进
5. **跟踪状态**: 使用 ✅ ❌ 等符号标记检查项

---

**模板版本**: v2.1.0
**维护者**: Smart Flow Team
**最后更新**: 2025-01-07
